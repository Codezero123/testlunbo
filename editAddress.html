<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<!-- <meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
		 -->
		<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
		<meta http-equiv="Cache-Control" content="no-cache"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<title>编辑地址</title>
		<meta name="keywords" content="" />
		<meta name="description" content="" />
		<!-- 是否启动webapp功能，会删除默认的苹果工具栏和菜单栏。 -->
		<meta name="apple-mobile-web-app-capable" content="yes">
		<!-- 当启动webapp功能时，显示手机信号、时间、电池的顶部导航栏的颜色。默认值为default（白色），可以定为black（黑色）和black-translucent（灰色半透明）。这个主要是根据实际的页面设计的主体色为搭配来进行设置。 -->
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<!-- 忽略页面中的数字识别为电话号码、email识别 -->
		<meta name="format-detection"content="telephone=no, email=no">
		<!-- 启用360浏览器的极速模式(webkit) -->
		<meta name="renderer" content="webkit">
		<!-- 避免IE使用兼容模式 -->
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<!-- 针对手持设备优化，主要是针对一些老的不识别viewport的浏览器，比如黑莓 -->
		<meta name="HandheldFriendly" content="true">
		<!-- 微软的老式浏览器 -->
		<meta name="MobileOptimized" content="320">
		<!-- uc强制竖屏 -->
		<meta name="screen-orientation" content="portrait">
		<!-- QQ强制竖屏 -->
		<meta name="x5-orientation" content="portrait">
		<!-- UC强制全屏 -->
		<meta name="full-screen" content="yes">
		<!-- QQ强制全屏 -->
		<meta name="x5-fullscreen" content="true">
		<!-- UC应用模式 -->
		<meta name="browsermode" content="application">
		<!-- QQ应用模式 -->
		<meta name="x5-page-mode" content="app">
		<!-- windows phone 点击无高光 -->
		<meta name="msapplication-tap-highlight" content="no">
		<!-- 网页不会被缓存 -->
		<meta http-equiv="Pragma" content="no-cache">
		<meta http-equiv="Cache-Control" content="no-cache">
		<meta http-equiv="Expires" content="0">
		<link rel="shortcut icon" href="/favicon.ico"/>
		<script>
			//单选按钮点击
			window.FastClick = true;
		</script>
		<script type="text/javascript" src="js/rem.js"></script>
		<link rel="stylesheet" type="text/css" href="css/mui.min.css"/>
		<link rel="stylesheet" type="text/css" href="css/static.css"/>
		<link rel="stylesheet" type="text/css" href="css/mui.picker.min.css" />
		<link rel="stylesheet" type="text/css" href="css/index.css"/>
	
	</head>
	<body>
				<!-- 主界面移动、菜单不动 -->
	<div class="mui-off-canvas-wrap mui-draggable">
		<!-- 主页面容器 -->
	  <div class="mui-inner-wrap">
			<!-- 主页面标题 -->
			<!-- 主页面标题 -->
			<header class="mui-bar mui-bar-nav">
				<a class="mui-icon mui-icon-arrowleft mui-pull-left back mui-action-back" href="javascript:history:back(-1)">返回</a>
				<h1 class="mui-title">编辑地址</h1>
			</header>
			<div class="mui-content mui-scroll-wrapper">
				<div class="mui-scroll">
					<!--这里放置真实显示的DOM内容-->
						<form class="mui-input-group mui-create-address">
					<div class="mui-input-row">
					<!-- 	<label>收货人姓名</label> -->
						<input type="text" class="mui-input-clear" id="addUserName" required="required" placeholder="收货人姓名"/>
					</div>
					<div class="mui-input-row">
						<!-- <label>联系电话</label> -->
						<input type="tel" class="mui-input-clear" id="addPhoneNum" required="required" placeholder="联系电话"/>
					</div>
					
					<div class="mui-input-row">
						<!-- <label>省、市、区</label> -->
						<span class="mui-icon mui-icon-arrowright"></span>
						<input type="text" id="adrress_city" class="mui-city" required="required" placeholder="省、市、区" readonly="readonly""/>
						
					</div>
					<div class="mui-input-row">
						<!-- <label>详细地址</label> -->
						<input type="text" class="mui-input-clear" id="add" required="required" placeholder="详细地址(不包含省市区)" />
					</div>
					
				</form>
				<div class="mui-input-row mui-checkbox mui-left mui-default-checkbox">
    				<label>设为默认地址</label>
    				<input id="addCheck" name="checkBox" type="checkbox" checked>
				</div>
				<div class="baocun-btn">
					<button id="addSave">保存</button>
				</div>
					<!-- <div class="mui-full-back"></div> -->
				</div>
			</div>
			<div class="mui-off-canvas-backdrop"></div>
		</div>
	</div>
	
		<script src="js/jquery-1.8.3.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="js/mui.poppicker.js" ></script>
		<script type="text/javascript" src="js/mui.picker.min.js"></script>
		<script type="text/javascript" src="js/data.city.js"></script>
		<script type="text/javascript">
			//初始化mui
			mui.init();
			
			$('#addSave').click(function(){
                let addUserName = $('#addUserName').val();
                let addPhoneNum = $('#addPhoneNum').val();
                let addCity = $('#adrress_city').val();
                let add = $('#add').val();
                let addCheck = 1;
                let reg = /^[1][3,4,5,7,8][0-9]{9}$/;
                if($('#addCheck').is(':checked') == true){
                    addCheck = 1;
                }else{
                    addCheck = 0;
                }
                
			    if(addUserName == "" || addUserName == null || addUserName == 'undefined'){
			        alert('请填写收货人姓名');
			    }else if(addPhoneNum == "" || addPhoneNum == null || addPhoneNum == 'undefined'){
                    alert('请填写联系电话');
                }else if(addCity == "" || addCity == null || addCity == 'undefined'){
                    alert('请选择省、市、区');
                }else if(add == "" || add == null || add == 'undefined'){
                    alert('请填写详细地址');
                }else{
                    if(reg.test(addPhoneNum)){
                        //添加地址ajax
                        mui.ajax('http://api.cskuaishou.com/hongjiu/app/address/insertAddress.do', {
                            dataType: 'json', //服务器返回json格式数据
                            data: {
                                userId: '6461c403a78841cc8e055566f73ab442',
                                linkMan: addUserName,
                                address: addCity+add,
                                telephone: addPhoneNum,
                                selected: addCheck
                            },
                            async: true, //是否异步
                            type: 'POST', //HTTP请求类型
                            cache: false, //是否缓存
                            success: function(userAdd) {
                                console.log(userAdd);
                                location.href = 'addressList.html';
                            },
                            error: function(xhr, type, errorThrown) {
                                console.log('xhr:', xhr);
                                console.log('type:', type);
                                console.log('errorThrown:', errorThrown);
                            }
                        });
                    }
                    else{
                        alert("手机号码格式不正确");
                        return false;
                    }
                }
			})
			
		
        	//选择省市区
        	var city_picker = new mui.PopPicker({
        		layer: 3,
        	});
        	city_picker.setData(init_city_picker);
        	$("#adrress_city").on("tap", function() {
        		city_picker.show(function(items) {
        			$("#adrress_city").val((items[0] || {}).text + "-" + (items[1] || {}).text + "-" + (items[2] || {}).text); //该ID为接收城市ID字段
        			/*$("#city_text").html((items[0] || {}).text + "" + (items[1] || {}).text + "" + (items[2] || {}).text);*/
        		});
        	});
		</script>
		<script src="js/index.js" type="text/javascript" charset="utf-8"></script>
	</body>
</html>
